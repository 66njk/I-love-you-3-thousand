# fs文件系统模块

> 原创内容，转载请注明出处！

# 一、什么是fs文件系统模块

fs 模块是 Node.js 官方提供的，用来操作文件的模块。它提供了一系列的方法和属性，用来满足用户对文件的操作需求。

例如：

- `fs.readFile()`方法，用来读取指定文件中的内容
- `fs.writeFile()`方法，用来向指定的文件中写入内容

如果要在 JavaScript 代码中，使用 fs 模块来操作文件，则需要使用如下的方式先导入它：

```javascript
const fs = require('fs');
```

# 二、读取指定文件中的内容

## 2.1 fs.readFile()的语法格式

使用`fs.readFile()`方法，可以读取指定文件中的内容，语法格式如下：

```javascript
fs.readFile(path[, options], callback)
```

参数解读：

- 参数1：必选参数，字符串，表示文件的路径
- 参数2：可选参数，表示以什么样的编码格式来读取文件，默认值是 null（如果未指定字符编码，则返回原始的 buffer）
- 参数3：必选参数，文件读取完成后，通过回调函数拿到读取的结果

## 2.2 fs.readFile()的示例代码

以 UTF-8 的编码格式为例，读取指定文件的内容，并打印 err 和 dataStr 的值：

```javascript
const fs = require('fs');

fs.readFile('文件路径', 'utf8', function(err, dataStr) {
    console.log(err);
    console.log('---------------');
    console.log(dataStr);
})
```

正式测试：

在`./files/`目录下有一个`test.txt`文件，内容为：`Wow~`。

代码：

```javascript
// 导入 fs 模块来操作文件
const fs = require('fs');

// 调用 fs.readFile() 方法读取文件
// 参数1：待读取文件的存放路径
// 参数2：读取文件时采用的编码格式，一般默认指定 utf8
// 参数3：回调函数，拿到读取失败和成功的结果 err dataStr
fs.readFile('./files/test.txt', 'utf8', (err, dataStr) => {
    // 如果读取成功，则 err 的值为 null
    // 如果读取失败，则 err 的值为错误对象，dataStr 的值为 undefined

    // 失败时，打印失败的结果：
    console.log(err);
    console.log('---------------');
    // 成功时，打印成功的结果：
    console.log(dataStr);
})
```

运行结果：

<img src="mark-img/image-20221201191734477.png" alt="image-20221201191734477" style="zoom:50%;" />

如果，我们将路径故意修改错误：`./files/err.txt`，再次运行：

<img src="mark-img/image-20221201192034834.png" alt="image-20221201192034834" style="zoom: 50%;" />

err 不再是`null`，而是错误信息：no such file or directory（没有这样的文件或目录）。

## 2.3 判断文件是否读取成功

方法：通过判断 err 对象是否为`null`，从而判断文件是否读取成功。

```javascript
const fs = require('fs');

fs.readFile('./files/test.txt', 'utf8', (err, result) => {
    if (err) {
        return console.log('文件读取失败！' + err.message);
    }
    console.log('文件读取成功，内容是：' + result);
})
```

成功时：

<img src="mark-img/image-20221201202128017.png" alt="image-20221201202128017" style="zoom:50%;" />

失败时（err.txt 文件不存在）：

<img src="mark-img/image-20221201202202132.png" alt="image-20221201202202132" style="zoom:50%;" />

# 三、向指定的文件中写入内容

## 3.1 fs.writeFile()的语法格式

使用`fs.writeFile()`方法，可以向指定的文件中写入内容，语法格式如下：

```javascript
fs.writeFile(file, data[, options], callback)
```

参数解读：

- 参数1：必选参数，需要指定一个文件路径的字符串，表示文件的存放路径
- 参数2：必选参数，表示要写入的内容
- 参数3：可选参数，表示以什么编码格式写入文件内容，默认值是 utf8
- 参数4：必选参数，文件写入完成后的回调函数

## 3.2 fs.writeFile()的实例代码

向指定的文件路径中，写入文件内容：

```javascript
const fs = require('fs');

fs.writeFile('文件路径', 'XXXXXXXXXX', function(err) {
    console.log(err);
})
```

向指定的文件路径中，写入 “Hello Node.js” 文件内容：

```javascript
const fs = require('fs');

fs.writeFile('./files/hello.txt', 'Hello Node.js!', err => {
    // 如果文件写入成功，则 err 的值为 null
    // 如果文件写入失败，则 err 的值为一个 错误对象
    console.log(err);
})
```

运行结果：

<img src="mark-img/image-20221201203749988.png" alt="image-20221201203749988" style="zoom:50%;" />

<img src="mark-img/image-20221201203757306.png" alt="image-20221201203757306" style="zoom:50%;" />

## 3.3 判断文件是否写入成功

方法：通过判断 err 对象是否为`null`，从而判断文件是否写入成功。

```javascript
const fs = require('fs');

fs.writeFile('./files/hello.txt', 'Hello Node.js!', err => {
    if (err) {
        return console.log('文件写入失败！' + err.message);
    }
    console.log('文件写入成功！');
})
```

成功时：

<img src="mark-img/image-20221201204809179.png" alt="image-20221201204809179" style="zoom:50%;" />

失败时（路径不存在，电脑上没有 w 盘符）：

<img src="mark-img/image-20221201204916749.png" alt="image-20221201204916749" style="zoom:50%;" />

# 四、练习：考试成绩整理

要求：使用 fs 文件系统模块，将素材目录下**成绩.txt**文件中的考试数据，整理到**成绩-ok.txt**文件中。

整理前：

```txt
小红=99 小白=100 小黄=70 小黑=66 小绿=88
```

整理后：

```txt
小红：99
小白：100
小黄：70
小黑：66
小绿：88
```

实现步骤：

- 导入需要的 fs 文件系统模块
- 使用 fs.readFile() 方法，读取素材目录下的 成绩.txt 文件
- 判断文件是否读取失败
- 文件读取成功后，处理成绩数据
- 将处理完成的成绩数据，调用 fs.writeFile() 方法，写入到新文件 成绩-ok.txt 中
- 判断文件是否写入成功

实现代码：

```javascript
const fs = require('fs');

// 调用 fs.readFile() 方法，读取成绩数据
fs.readFile('./files/成绩.txt', 'utf8', (err, dataStr) => {
    if (err) {
        return console.log('文件读取失败：' + err.message);
    }

    // 将成绩数据按照空格进行分割
    const arrOld = dataStr.split(' ');

    // 循环分割后的数组，对每一项数据进行字符串的替换操作
    const arrNew = [];
    arrOld.forEach(item => {
        arrNew.push(item.replace('=', '：'));
    })

    // 把新数组中的每一项进行合并，得到一个新的字符串
    const newStr = arrNew.join('\r\n');

    // 调用 fs.writeFile() 方法，把处理完的成绩数据，写入到新文件中
    fs.writeFile('./files/成绩-ok.txt', newStr, err => {
        if (err) {
            return console.log('文件写入失败：' + err.message);
        }
        console.log('文件写入成功！')
    })
})
```

